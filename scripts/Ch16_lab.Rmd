---
title: "Ch16_lab"
author: "Holden Jones"
date: '2022-10-31'
output: html_document
---

# Dates and times


--------------------------------------------------------------------------------
# 16.1 Introduction

dates and times hard b/c have to reconcile physical with geopolitical things

## 16.1.1 Prerequisites

lubridate package
```{r}
library(tidyverse)
library(lubridate)
library(nycflights13)
```


--------------------------------------------------------------------------------
# 16.2 Creating date/times

date, time and date-time(<dttm>)
use hms package to store times

three ways likely to create a date/time:
- string
- individual date-time components
- from existing date/time object

## 16.2.1 From strings

use lubridate functions, specify order / format of date from string
```{r}
ymd("2017-01-31")
mdy("January 31st, 2017")
dmy("31-Jan-2017")
```

also take unquoted numbers which is usually best/easiest

ymd() with _ to create datetimes
```{r}
ymd("2017-01-31")
ymd_hms("2017-01-31 20:11:59")
```

## 16.2.2 From individual components

sometimes will have ind componets of date-time spread across multiple columns
```{r}
# ex. flights data
flights %>% 
  select(year, month, day, hour, minute)
```

use make_date() for dates, make_datetime() for date-times:
```{r}
flights %>% 
  select(year, month, day, hour, minute) %>% 
  mutate(departure = make_datetime(year, month, day, hour, minute))

# can do same thing for each of 4 time columns in flights, use modulus:
make_datetime_100 <- function(year, month, day, time) {
  make_datetime(year, month, day, time %/% 100, time %% 100)
}

flights_dt <- flights %>% 
  filter(!is.na(dep_time), !is.na(arr_time)) %>% 
  mutate(
    dep_time = make_datetime_100(year, month, day, dep_time),
    arr_time = make_datetime_100(year, month, day, arr_time),
    sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
    sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)
  ) %>% 
  select(origin, dest, ends_with("delay"), ends_with("time"))

flights_dt

# and can visualize the distribution of departure times across year
flights_dt %>% 
  ggplot(aes(dep_time)) + 
  geom_freqpoly(binwidth = 86400) # 86400 seconds = 1 day

# or single day
flights_dt %>% 
  filter(dep_time < ymd(20130102)) %>% 
  ggplot(aes(dep_time)) + 
  geom_freqpoly(binwidth = 600) # 600 s = 10 minutes
```

when use date-times in numeric context (like histogram), 1 means 1 second, so
bindwidth of 86400 equals one day. for dates, 1 means 1 day

## 16.2.3 From other types

May want to switch between date-time and date. use as_datetime() and as_date()






